<!DOCTYPE html>
<html>
  <head>
    <script>
      var sensor = {open: false};

      function launch() { 
        document
          .getElementById("video-frame")
          .src = "https://www.youtube.com/embed/Iwn4LVVvAUQ?autoplay=1&mute=1&start=12&controls=0"
      }

      function createFrame(){
        const frame = document.createElement("iframe")
        frame.id = "video-frame"
        frame.width = 420
        frame.height = 315
        const div = document.getElementById("frame")
        div.appendChild(frame)
      }

      async function updateSensor() {
        sensor = await fetch('http://localhost:8080/sensor').then(res=>res.json()) 
      }
      
      function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function checkSensor() {
        const canvas = document.getElementById('indicator')
        const ctx = canvas.getContext('2d')
        while (!sensor.open) {
          await updateSensor()
          console.log(sensor)
          ctx.fillStyle = "rgb(200, 0, 0)"
          ctx.fillRect(10,10,50,50)
          await delay(500)
        }
        canvas.remove()
        createFrame()
        launch()
      }
    </script>
  </head>
  <body onload="checkSensor()">
    <div id="frame"></div>
    <canvas id="indicator" width="150" height="150">sensor indicator</canvas>
    <br/>
    <button type="button" onclick="createFrame()">Create</button>
    <button type="button" onclick="launch()">Launch</button>
    <button type="button" onclick="checkSensor()">Check Sensor</button>
  </body>
</html>